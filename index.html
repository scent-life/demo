<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Scent</title>

    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">

    <link rel="shortcut icon" href="./img/favicon.ico">

    <!-- iPad and iPad mini (with @2× display) iOS ≥ 8 -->
    <link rel="apple-touch-icon-precomposed" sizes="180x180" href="./assets/img/scent icon.png">
    <!-- iPad 3+ (with @2× display) iOS ≥ 7 -->
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="./assets/img/scent icon.png">
    <!-- iPad (with @2× display) iOS ≤ 6 -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="./assets/img/scent icon.png">
    <!-- iPhone (with @2× and @3 display) iOS ≥ 7 -->
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="./assets/img/scent icon.png">
    <!-- iPhone (with @2× display) iOS ≤ 6 -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="./assets/img/scent icon.png">
    <!-- iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7 -->
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="./assets/img/scent icon.png">
    <!-- iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6 -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./assets/img/scent icon.png">
    <!-- Android Stock Browser and non-Retina iPhone and iPod Touch -->
    <link rel="apple-touch-icon-precomposed" href="assets/img/scent icon.png">
    <!-- Fallback for everything else -->
    <link rel="shortcut icon" href="assets/img/scent icon.png">

    <link href="http://g.alicdn.com/kissy/k/5.0.1/css/base.css" rel="stylesheet" />
    <link href="http://g.alicdn.com/kissy/k/5.0.1/navigation-view/assets/dpl.css" rel="stylesheet">
    <link href="http://g.alicdn.com/kissy/k/5.0.1/scroll-view/assets/dpl.css" rel="stylesheet" />

    <link href="./assets//css/index.css" rel="stylesheet" />
</head>

<body>
    <script type="text/tpl" id="p0">
        <a href="/p1" class="nav back">&nbsp;</a>
        <a href="/p1" class="nav">
            <img src="./assets/img/page0.png" class="full" />
        </a>

    </script>

    <script type="text/tpl" id="p1">
        <a href="/p0" class="nav back">&nbsp;</a>
        <a href="/p4" class="nav social-link">&nbsp;</a>
        <a href="/p2" class="nav mixer-link">&nbsp;</a>
        <img src="./assets/img/page1.png" class="full" />

    </script>

    <script type="text/tpl" id="p2">
        <a href="/p1" class="nav back">&nbsp;</a>
        <a href="/p3" class="nav">
            <img src="./assets/img/p2ball1.png" class="p2ball1" />
            <img src="./assets/img/p2ball2.png" class="p2ball2" />
            <img src="./assets/img/p2ball3.png" class="p2ball3" />
            <img src="./assets/img/p2ball4.png" class="p2ball4" />
            <img src="./assets/img/p2ball5.png" class="p2ball5" />
            <img src="./assets/img/page2.png" class="full" />
        </a>

    </script>

    <script type="text/tpl" id="p3">
        <a href="/p2" class="nav back">&nbsp;</a>
        <img src="./assets/img/page3.png" class="full" />

    </script>

    <script type="text/tpl" id="p4">
        <a href="/p1" class="nav back">&nbsp;</a>
        <a href="/p5" class="nav person-link">&nbsp;</a>
        <a href="/p5" class="nav set-link">&nbsp;</a>
        <img src="./assets/img/page4.png" class="full" />

    </script>

    <script type="text/tpl" id="p5">
        <a href="/p4" class="nav back">&nbsp;</a>
        <a href="/p6" class="nav style-link">&nbsp;</a>
        <div class="mixer-link j-social">&nbsp;</div>
        <div class="popup">
            <div class="btns">
                <a href="#" class="nav anim-like">
                    <img src="./assets/img/btn-like.png" />
                </a>
                <a href="#" class="nav anim-test">
                    <img src="./assets/img/btn-test.png" />
                </a>
                <a href="/p7" class="nav anim-mix">
                    <img src="./assets/img/btn-mix.png" />
                </a>
            </div>
            <div class="backdrop"></div>
        </div>
        <img src="./assets/img/page5.png" class="full" />
    </script>

    <script type="text/js" id="p5-js">
    require(['node'], function($) {
        setTimeout(function() {
            var $popup = $('.popup'),
                $social = $('.j-social'),
                $backdrop = $('.backdrop');
            $social.on('click', function() {
                $popup.addClass('show');
                window.navigationView.get('activeView').scrollTo({
                    top: 0
                });
            });

            $backdrop.on('click', function() {
                $popup.removeClass('show');
            });

        }, 0);
    });
    </script>

    <script type="text/tpl" id="p6">
        <a href="/p5" class="nav back">&nbsp;</a>
        <img src="./assets/img/page6.png" class="full" />

    </script>

    <script type="text/tpl" id="p7">
        <a href="/p5" class="nav mix-wrapper">
            <div class="mix">
                <div class="b1"></div>
                <div class="b2"></div>
                <div class="b3"></div>
                <div class="b4"></div>
                <div class="b5"></div>
            </div>
            <div class="done">
                <img src="./assets/img/page7.png">
            </div>
        </a>
    </script>

    <script type="text/js" id="p7-js">
    require(['node'], function($) {
        setTimeout(function() {
            var $mix = $('.mix-wrapper');
            setTimeout(function() {
                $mix.addClass('end');
            }, 3500);
        }, 0);
    });
    </script>

    <div class="preload-images">
        <img src="./assets/img/page0.png" width="1" height="1" />
        <img src="./assets/img/page1.png" width="1" height="1" />
        <img src="./assets/img/page2.png" width="1" height="1" />
        <img src="./assets/img/page3.png" width="1" height="1" />
        <img src="./assets/img/page4.png" width="1" height="1" />
        <img src="./assets/img/page5.png" width="1" height="1" />
        <img src="./assets/img/page6.png" width="1" height="1" />
        <img src="./assets/img/page7.png" width="1" height="1" />
    </div>

    <script src="http://g.alicdn.com/kissy/k/5.0.1/seed.js" data-config="{combine:true}"></script>
    <script>
    require(['navigation-view', 'scroll-view', 'scroll-view/plugin/scrollbar', 'router', 'node', 'event-dom/gesture/tap'], function(NavigationView, ScrollView, ScrollBar, router, $, GestureTap) {

        var INDEX_PAGE = 'p0';

        var navigationView = new NavigationView({
            render: 'body'
        }).render();


        function getStepTpl(targetStep) {
            return $('#' + targetStep).html();
        }

        function switchStep(targetStep) {
            navigationView.push({
                viewId: targetStep,
                xclass: 'page-view'
                //animation: ['slide-top', 'slide-bottom'] //使用动画效果切换视图
            });
        }

        function switchPage(pageId) {
            var activeView = navigationView.get('activeView'),
                activeViewId = activeView && activeView.get('viewId');

            var animation = 'slide-right';

            if (activeViewId && pageId < activeViewId) {
                animation = 'slide-left';
            }

            navigationView.push({
                xclass:    'page-view',
                viewId:    pageId,
                animation: animation
            });

            if (activeView) {
                navigationView.removeChild(activeView);
            }
            //console.log(animation);
        }

        $('body').delegate('click', '.nav', function(ev) {
            ev.halt();
            router.navigate( $(ev.currentTarget).attr('href') );
        });

        var PageView = ScrollView.extend({
            getViewId: function() {
                return this.get('viewId');
            },
            createDom: function() {
                var viewId = this.get('viewId');
                this.get('contentEl')
                    .html( getStepTpl(viewId), true )
                    .addClass(viewId);

                var script = $('#' + viewId + '-js');
                if (script) {
                    eval( script.html() );
                }

            },
            enter: function() {
                this.sync();
                this.timer = setInterval(this.sync.bind(this), 200);
                //setTimeout(this.sync.bind(this), 400);
                //this.sync();
                $(window).on('resize', this.sync, this);
            },
            leave: function() { //navigationView.pop()会触发事件进入该函数
                $(window).detach('resize', this.sync, this);
                clearInterval(this.timer);

            }
        }, {
            xclass: 'page-view',
            ATTRS: {
                plugins: [ScrollBar] //使用了 ScrollBar 插件，则该视图右侧栏有滚动条显示
            }
        });

        router.get('/', function (request) {
            switchPage(INDEX_PAGE);
        });

        router.get('/:page', function (request) {
            switchPage(request.params.page)
        });

        router.config({
            urlRoot: '/',
            useHash: true,
            triggerRoute: true
        });


        router.start();
        window.navigationView = navigationView;
    });

    </script>

</body>

</html>
